{% load comments i18n crispy_forms_tags %}

<div id="anchor-quote"></div>
<div class="well">
    <div class="vmaig-comment">
        <ul>
            {% for comment in comment_list %}
                <li>

                    <div class="vmaig-comment-content">
                        <h4 style="    color: #777;font-size: 14px;">{{ comment.user_name }}
                            ：<span>{{ comment.submit_date }}</span></h4> {# 用户名，昵称 | 发表评论的时间#}
                        {#            {{ comment.parent_id }}#}
                        {% if comment.parent %}
                            <div class="comment-quote">
                                <p style="border: 2px solid #EEE; padding: 5px;">
                                    <a>@{{ comment.parent.user_name }}：</a> {# 父类的评论者 #}
                                    {% autoescape on %}
                                        {{ comment.parent.comment }}      {# 父类的评论内容 #}
                                        {#                            {{ comment.parent_id }}#}
                                    {% endautoescape %}
                                </p>
                            </div>
                        {% endif %}
                        <p></p>
                        <p style="font-size: 18px">
                            {% autoescape on %}
                                {{ comment.comment }}     {# 评论内容 #}
                            {% endautoescape %}

                            <button type="button" id='click' href="#c{{ comment.id }}"
                                    data-comment-id="{{ comment.id }}"
                                    onclick="return CommentQuote('{{ comment.user_name }}',{{ comment.id }});">回复
                            </button>
                        </p>

                        <div class="panel-body" id='text' style='display:none;'>
                            <form id="comment_f" class="form-horizontal" method="post"
                                  action="{% comment_form_target %}"
                                  role="form"> {##}
                                {% csrf_token %}
                                {% if next %}
                                    <div><input type="hidden" name="next" value="{{ next }}"/></div>
                                {% endif %}

                                {# 必须的字段 #}
                                {{ blog_form.object_pk }}
                                {{ blog_form.content_type }}
                                {{ blog_form.timestamp }}
                                {{ blog_form.site }}
                                {{ blog_form.submit_date }}
                                {{ blog_form.security_hash }}

                                {# 用户名字段，这个后面会修改为登录用户评论，无需填这个 #}
                                <div class="control-group">
                                    <label class="control-label" for="id_name">名称： </label>
                                    <div class="controls">
                                        <input type="text"
                                               id="id_name" class="input-xlarge" name="name"
                                               placeholder="请输入您的用户名"
                                               value="{{ user.username }}"/>
                                    </div>
                                </div>

                                {# 邮箱地址字段 #}
                                <div class="control-group">
                                    <label class="control-label" for="id_email">邮箱： </label>
                                    <div class="controls">
                                        <input type="email"
                                               id="id_email" class="input-xlarge" name="email"
                                               placeholder="请输入您的邮箱地址"
                                               value="{{ user.email }}"/>
                                    </div>
                                </div>

                                {# 评论内容 #}
                                <a name="newcomment" id="newcomment"></a>
                                <div class="control-group">
                                    <label class="control-label" for="id_comment">评论： </label>
                                    <div class="controls">
                                        <textarea id="id_comment" name="comment" class="form-control" rows="4"
                                                  placeholder="请输入评论 限200字!"></textarea>
                                    </div>
                                </div>

                                {# 防垃圾评论 #}
                                <p style="display:none;">
                                    <label for="id_honeypot">如果你在该字段中输入任何内容，你的评论就会被视为垃圾评论。</label>
                                    <input type="text" name="honeypot" id="id_honeypot">
                                </p>

                                {# 表单按钮 #}
                                <div class="controls">
                                    <div class="form-actions">
                                        <input class="btn btn-info" id="submit_btn" type="submit" name="submit"
                                               value="提交"/>
                                        {#  评论后返回的页面重定向到当前页面#}
                                        <input type="hidden" name="next" value="{% url 'myApp1:detail' post.id %}"/>
                                    </div>
                                </div>
                            </form>
                        </div>

                        <hr style=" margin-top: 20px; margin-bottom: 20px; border: 0; border-top-width: 0px; border-top-style: none; border-top-color: currentcolor; border-top: 1px solid #b3f3c1;">
                    </div>
                </li>
            {% endfor %}
        </ul>
    </div>
</div>
<script language="javascript" type="text/javascript">
    {#<!--隐藏回复评论框-->#}
    {#window.onload = function () {#}
    {#    document.getElementById('click').onclick = function () {#}
    {#        if (document.getElementById('text').style.display == 'none') {#}
    {#            document.getElementById('text').style.display = 'block';#}
    {#        }#}
    {#        else {#}
    {#            document.getElementById('text').style.display = 'none';#}
    {#        }#}
    {#    }#}
    //    }

    $(document).ready(function () {
        $('button').click(function () {
            $('#text').toggle();
        })
    })

    {#此函数用来将父评论的id和name赋值到文本框和地址栏#}

    function CommentQuote(user_name, commend_id) {
        var $this = $(this);
        commentd = document.getElementById('id_comment');
        {#alert(commend_id);#}
        commentd.value = "@['" + user_name + "', " + commend_id + "]: ";    //将@[name，id]填入文本框
        {#commentd.focus();#}
        {#commentd.setSelectionRange(commentd.value.length, commentd.value.length);#}
        $('#id_parent').val(commend_id);
        $('#newcomment').appendTo($this.closest('.media-body'));
        {#alert(commend_id)#}
    };

</script>

